(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{145:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(147),c=a(146),o=a(160),i=a.n(o),u=(a(36),a(37),a(151),a(161)),l=a.n(u),d=(a(148),a(34)),p=a.n(d),h=a(7),m=a.n(h),f=a(163),g=a(162),w=a(180),k=a.n(w),v=function(e){function t(t){var a;a=e.call(this,t)||this;var n="undefined"==typeof window?{success:!1,userId:"",secret:""}:JSON.parse(localStorage.getItem("sd60:authenticate"));return null===n&&(n={success:!1,userId:"",secret:""}),a.state={isAuthenticated:n.success||!1,userId:n.userId||"",secret:n.secret||"",accounts:[],progressBar:{class:k.a.waitingForUpdate}},a.fetcAccounts=a.fetchAccounts.bind(p()(a)),a}m()(t,e);var a=t.prototype;return a.componentDidMount=function(){console.log("component did mount. state:",this.state),!1===this.state.isAuthenticated&&Object(f.a)("/authenticate"),this.state.isAuthenticated&&(console.log("FEtching accounts"),this.fetchAccounts())},a.render=function(){var e=this.state,t=e.accounts,a=e.progressBar;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:k.a.updateProgressIndicator},s.a.createElement("div",{className:a.class})),s.a.createElement("ul",{className:k.a.list},t.map(function(e){return s.a.createElement("li",{className:k.a.item,key:e.accountId},s.a.createElement("div",{className:k.a.itemWrapper},s.a.createElement("h3",{className:k.a.name},e.name),s.a.createElement("div",{className:k.a.available},s.a.createElement("span",null,"kr "),e.available.toFixed(2)),s.a.createElement("div",{className:k.a.balanceDiv},s.a.createElement("span",null,"kr "),e.balance.toFixed(2))))})))},a.getAccessToken=function(){var e=l()(i.a.mark(function e(){var t,a,n,s,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=JSON.parse(localStorage.getItem("sd60:token")),a=new Date(t.date),n=new Date,!(a.getTime()+1e3*(t.expires_in-300)>n.getTime())){e.next=5;break}return e.abrupt("return",Promise.resolve(t.access_token));case 5:return e.next=7,fetch(g.a.token,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"client_credentials",client_id:this.state.userId,client_secret:this.state.secret})});case 7:if((s=e.sent).ok){e.next=10;break}throw new Error("Invalid response: "+s.status+" "+s.statusText);case 10:return e.next=12,s.json();case 12:if((r=e.sent).hasOwnProperty("access_token")&&r.hasOwnProperty("expires_in")){e.next=16;break}throw console.warn(r),new Error("Something is not right with the access_token Response.");case 16:return r.date=new Date,localStorage.setItem("sd60:token",JSON.stringify(r)),e.abrupt("return",r.access_token);case 19:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a.fetchAccounts=function(){var e=l()(i.a.mark(function e(){var t,a,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccessToken();case 2:return t=e.sent,e.next=5,fetch(g.a.balance,{method:"get",headers:{Authorization:"Bearer "+t}});case 5:return a=e.sent,console.log("result:",a.status,a.statusText),e.next=9,a.json();case 9:if(n=e.sent,a.ok){e.next=13;break}return console.warn("error text:",n),e.abrupt("return");case 13:console.log("Getting ready for timeout"),this.setState({accounts:n,progressBar:{class:k.a.waitingForUpdate}}),setTimeout(function(){console.log("Got timeout"),this.setState({progressBar:{class:k.a.gotUpdate}}),this.fetchAccounts()}.bind(this),3e4);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t}(s.a.Component);t.default=function(){return s.a.createElement(r.a,{headerTitle:"Saldo - Again"},s.a.createElement(c.a,{title:"Home",keywords:["gatsby","open banking","react"]}),s.a.createElement(v,null))}}}]);
//# sourceMappingURL=component---src-pages-index-js-078e00f332fc1c346e6a.js.map