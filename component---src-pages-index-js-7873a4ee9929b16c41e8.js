(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{147:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(152),s=n(149),i=(n(36),n(37),n(153),n(34)),c=n.n(i),l=n(7),u=n.n(l),m=n(162),d=n(161),p=n(182),h=n.n(p),g=function(e){function t(t){var n;n=e.call(this,t)||this;var a="undefined"==typeof window?{success:!1,userId:"",secret:""}:JSON.parse(localStorage.getItem("sd60:authenticate"));return null===a&&(a={success:!1,userId:"",secret:""}),n.state={isAuthenticated:a.success||!1,userId:a.userId||"",secret:a.secret||"",accounts:[]},console.log("state:",n.state),n.fetcAccounts=n.fetchAccounts.bind(c()(n)),n}u()(t,e);var n=t.prototype;return n.componentDidMount=function(){!1===this.state.isAuthenticated&&Object(m.a)("/authenticate"),this.state.isAuthenticated&&this.fetchAccounts()},n.render=function(){return r.a.createElement("ul",{className:h.a.list},this.state.accounts.map(function(e){return r.a.createElement("li",{className:h.a.item,key:e.accountId},r.a.createElement("div",{className:h.a.itemWrapper},r.a.createElement("h3",{className:h.a.name},e.name),r.a.createElement("div",{className:h.a.available},r.a.createElement("span",null,"kr "),e.available.toFixed(2)),r.a.createElement("div",{class:h.a.balanceDiv},r.a.createElement("span",null,"kr "),e.balance.toFixed(2))))}))},n.getAccessToken=function(){var e=JSON.parse(localStorage.getItem("sd60:token")),t=new Date(e.date),n=new Date;return t.getTime()+1e3*(e.expires_in-300)>n.getTime()?Promise.resolve(e.access_token):fetch(d.a.token,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"client_credentials",client_id:this.state.userId,client_secret:this.state.secret})}).then(function(e){if(e.ok)return e.json();throw new Error("Invalid response: "+e.status+" "+e.statusText)}).then(function(e){if(!e.hasOwnProperty("access_token")||!e.hasOwnProperty("expires_in"))throw console.warn(e),new Error("Something is not right with the access_token Response.");return e.date=new Date,localStorage.setItem("sd60:token",JSON.stringify(e)),e.access_token}).catch(function(e){return console.error(e.message)})},n.fetchAccounts=function(){var e=this;return this.getAccessToken().then(function(e){return fetch(d.a.balance,{method:"get",headers:{Authorization:"Bearer "+e}})}).then(function(e){return console.log("result:",e.status,e.statusText),e.ok?e.json():e.json().then(function(e){console.log("error text:",e)})}).then(function(t){console.log(t),e.setState({accounts:t})})},t}(r.a.Component);t.default=function(){return r.a.createElement(o.a,{headerTitle:"Saldo - Again"},r.a.createElement(s.a,{title:"Home",keywords:["gatsby","open banking","react"]}),r.a.createElement(g,null))}},148:function(e){e.exports={a:"0.5.1"}},149:function(e,t,n){"use strict";var a=n(150),r=n(0),o=n.n(r),s=n(4),i=n.n(s),c=n(160),l=n.n(c);function u(e){var t=e.description,n=e.lang,r=e.meta,s=e.keywords,i=e.title,c=a.data.site,u=t||c.siteMetadata.description;return o.a.createElement(l.a,{htmlAttributes:{lang:n},title:i,titleTemplate:"%s | "+c.siteMetadata.title,meta:[{name:"description",content:u},{property:"og:title",content:i},{property:"og:description",content:u},{property:"og:type",content:"website"},{name:"twitter:card",content:"summary"},{name:"twitter:creator",content:c.siteMetadata.author},{name:"twitter:title",content:i},{name:"twitter:description",content:u}].concat(s.length>0?{name:"keywords",content:s.join(", ")}:[]).concat(r)})}u.defaultProps={lang:"en",meta:[],keywords:[],description:""},u.propTypes={description:i.a.string,lang:i.a.string,meta:i.a.arrayOf(i.a.object),keywords:i.a.arrayOf(i.a.string),title:i.a.string.isRequired},t.a=u},150:function(e){e.exports={data:{site:{siteMetadata:{title:"Saldo",description:"A simple progressive web app to see the balance of banking accounts",author:"thomas@malt.no"}}}}},151:function(e,t,n){var a;e.exports=(a=n(163))&&a.default||a},152:function(e,t,n){"use strict";var a=n(7),r=n.n(a),o=n(0),s=n.n(o),i=n(4),c=n.n(i),l=n(154),u=n(34),m=n.n(u),d=(n(153),n(155),function(e){var t=e.name,n=e.trigger;return console.log("icon:",t,n),s.a.createElement("button",{className:"icon-button",onClick:n},s.a.createElement("i",null,t))}),p=(n(156),function(e){var t=e.headerTitle,n=e.trigger;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{id:"app-bar"},s.a.createElement(d,{name:"menu",trigger:n}),s.a.createElement("h6",{id:"title"},t)))}),h=n(157),g=n.n(h),f=function(e){function t(t){var n;return(n=e.call(this,t)||this).openMenu=function(e){console.log("open menu:",e),n.setState({mainMenu:g.a.mainMenuOpen})},n.closeMenu=function(e){console.log("close menu:",e),n.setState({mainMenu:g.a.mainMenuClosed})},n.handleTouchStart=function(e){console.log("touch start:",e)},console.log("header constructor"),n.state={mainMenu:g.a.mainMenuClosed},n.openMenu=n.openMenu.bind(m()(n)),n}return r()(t,e),t.prototype.render=function(){var e=this.props.headerTitle;return s.a.createElement(s.a.Fragment,null,s.a.createElement("header",null,s.a.createElement(p,{headerTitle:e,trigger:this.openMenu})),s.a.createElement("nav",{id:g.a.mainMenu,onTouchStart:this.handleTouchStart,className:this.state.mainMenu},s.a.createElement("div",{id:"TopBar"},s.a.createElement("h6",{className:g.a.topbarTitle},"Hovedmeny"),s.a.createElement(d,{name:"close",trigger:this.closeMenu})),s.a.createElement("div",{className:g.a.topbarMenuItems},s.a.createElement("ul",null,s.a.createElement("li",null,"Logg ut")))))},t}(s.a.Component);f.propTypes={siteTitle:c.a.string},f.defaultProps={siteTitle:""};var E=f,v=n(148),w=(n(158),n(159),l.a.span.withConfig({displayName:"Layout__Version",componentId:"sc-1obgvso-0"})(["font-weight:700;"])),y=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){var e=this.props,t=e.headerTitle,n=e.children;return s.a.createElement("main",null,s.a.createElement(E,{headerTitle:t}),s.a.createElement("section",null,n),s.a.createElement("footer",null,s.a.createElement("div",null,"Version ",s.a.createElement(w,null,v.a)," by Thomas Malt Â©"," ",(new Date).getFullYear()),s.a.createElement("div",{id:"built-with"},"Built with"," ",s.a.createElement("a",{href:"https://www.gatsbyjs.org"},"Gatsby"))))},t}(s.a.Component);y.propTypes={children:c.a.node.isRequired};t.a=y},161:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a={urls:{token:"https://api.malt.no/banking/oauth2/token",balance:"https://api.malt.no/banking/balance"}},r=a.urls},162:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(4),s=n.n(o),i=n(33);n.d(t,"a",function(){return i.navigate});n(151),r.a.createContext({});s.a.object,s.a.string.isRequired,s.a.func,s.a.func},163:function(e,t,n){"use strict";n.r(t);n(35);var a=n(0),r=n.n(a),o=n(4),s=n.n(o),i=n(56),c=n(2),l=function(e){var t=e.location,n=c.default.getResourcesForPathnameSync(t.pathname);return n?r.a.createElement(i.a,Object.assign({location:t,pageResources:n},n.json)):null};l.propTypes={location:s.a.shape({pathname:s.a.string.isRequired}).isRequired},t.default=l}}]);
//# sourceMappingURL=component---src-pages-index-js-7873a4ee9929b16c41e8.js.map