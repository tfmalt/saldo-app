(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{145:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(147),c=n(146),o=n(160),i=n.n(o),u=(n(36),n(37),n(151),n(161)),l=n.n(u),h=(n(148),n(34)),d=n.n(h),p=n(7),m=n.n(p),f=n(163),g=n(162),w=n(180),k=n.n(w),b=function(e){function t(t){var n;n=e.call(this,t)||this;var a="undefined"==typeof window?{success:!1,userId:"",secret:""}:JSON.parse(localStorage.getItem("sd60:authenticate"));return null===a&&(a={success:!1,userId:"",secret:""}),n.state={isAuthenticated:a.success||!1,userId:a.userId||"",secret:a.secret||"",accounts:[]},n.fetcAccounts=n.fetchAccounts.bind(d()(n)),n}m()(t,e);var n=t.prototype;return n.componentDidMount=function(){console.log("component did mount. state:",this.state),!1===this.state.isAuthenticated&&Object(f.a)("/authenticate"),this.state.isAuthenticated&&(console.log("FEtching accounts"),this.fetchAccounts())},n.render=function(){var e=this.state.accounts;return s.a.createElement("ul",{className:k.a.list},e.map(function(e){return s.a.createElement("li",{className:k.a.item,key:e.accountId},s.a.createElement("div",{className:k.a.itemWrapper},s.a.createElement("h3",{className:k.a.name},e.name),s.a.createElement("div",{className:k.a.available},s.a.createElement("span",null,"kr "),e.available.toFixed(2)),s.a.createElement("div",{className:k.a.balanceDiv},s.a.createElement("span",null,"kr "),e.balance.toFixed(2))))}))},n.getAccessToken=function(){var e=l()(i.a.mark(function e(){var t,n,a,s,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=JSON.parse(localStorage.getItem("sd60:token")),n=new Date(t.date),a=new Date,!(n.getTime()+1e3*(t.expires_in-300)>a.getTime())){e.next=5;break}return e.abrupt("return",Promise.resolve(t.access_token));case 5:return e.next=7,fetch(g.a.token,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"client_credentials",client_id:this.state.userId,client_secret:this.state.secret})});case 7:if((s=e.sent).ok){e.next=10;break}throw new Error("Invalid response: "+s.status+" "+s.statusText);case 10:return e.next=12,s.json();case 12:if((r=e.sent).hasOwnProperty("access_token")&&r.hasOwnProperty("expires_in")){e.next=16;break}throw console.warn(r),new Error("Something is not right with the access_token Response.");case 16:return r.date=new Date,localStorage.setItem("sd60:token",JSON.stringify(r)),e.abrupt("return",r.access_token);case 19:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),n.fetchAccounts=function(){var e=l()(i.a.mark(function e(){var t,n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccessToken();case 2:return t=e.sent,e.next=5,fetch(g.a.balance,{method:"get",headers:{Authorization:"Bearer "+t}});case 5:return n=e.sent,console.log("result:",n.status,n.statusText),e.next=9,n.json();case 9:if(a=e.sent,n.ok){e.next=13;break}return console.warn("error text:",a),e.abrupt("return");case 13:console.log("Getting ready for timeout"),this.setState({accounts:a}),setTimeout(function(){console.log("Got timeout"),this.fetchAccounts()}.bind(this),6e4);case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t}(s.a.Component);t.default=function(){return s.a.createElement(r.a,{headerTitle:"Saldo - Again"},s.a.createElement(c.a,{title:"Home",keywords:["gatsby","open banking","react"]}),s.a.createElement(b,null))}}}]);
//# sourceMappingURL=component---src-pages-index-js-9423f04855fa3f527dbd.js.map